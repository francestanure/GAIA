<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>GAIA – Agentes EDA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --gaia-green:#2E7D68;
      --gaia-soft: rgba(46,125,104,.05);
    }
    *{box-sizing:border-box}
    body{background:#fff;font-family:Poppins,Arial;color:var(--gaia-green);display:flex;justify-content:center;align-items:flex-start;margin:0}
    .container{background:var(--gaia-soft);padding:30px 40px;border-radius:15px;max-width:980px;width:100%;box-shadow:0 4px 15px rgba(0,0,0,.1);margin:24px}
    h1{margin:0 0 8px}
    h2{margin:0 0 16px;font-size:18px}
    label{font-size:13px;display:block;margin-bottom:6px}
    input,select,button,textarea{font-family:Poppins,Arial}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--gaia-green);border-radius:8px;color:var(--gaia-green);background:#fff}
    button{padding:12px 16px;background:var(--gaia-green);color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer}
    .section{background:#fff;padding:16px;border-radius:12px;margin:16px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end}
    .col{flex:1 1 320px;min-width:260px}
    .col-narrow{flex:0 0 180px}
    .hint{font-size:12px;opacity:.8;margin-top:6px}
    .grid-2{display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:12px}
    .grid-3{display:grid;grid-template-columns:repeat(3,minmax(160px,1fr));gap:12px}
    .subtle{font-size:12px;opacity:.85;margin:6px 0 0}
    .divider{height:1px;background:rgba(46,125,104,.2);margin:12px 0;border-radius:1px}
  </style>
</head>
<body>
  <div class="container">
    <h2>GAIA – Agentes EDA</h2>

    <!-- FORMULÁRIO: envia direto ao webhook -->
    <form method="POST" action="https://n8n-service-to7f.onrender.com/webhook-test/trabalho_final" class="section" id="gaia-form">
      <div class="row">
        <div class="col">
          <label>Pergunta (modo padrão)</label>
          <input type="text" name="pergunta" placeholder="Ex.: receita mensal, ticket médio SP, top 10 fornecedores por receita"/>
        </div>

        <div class="col-narrow">
          <label>UF</label>
          <select name="uf">
            <option value="ALL" selected>ALL</option>
            <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option>
            <option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option>
            <option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option>
            <option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option>
            <option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option>
            <option>SE</option><option>TO</option>
          </select>
        </div>

        <div class="col-narrow">
          <label>Data início (YYYY-MM-DD)</label>
          <input type="text" name="data_inicio" placeholder="YYYY-MM-DD"/>
        </div>

        <div class="col-narrow">
          <label>Data fim (YYYY-MM-DD)</label>
          <input type="text" name="data_fim" placeholder="YYYY-MM-DD"/>
        </div>

        <div class="col-narrow">
          <label>Modo</label>
          <select name="modo" id="modo">
            <option value="padrao" selected>Padrão</option>
            <option value="preditivo">Preditivo</option>
          </select>
        </div>

        <div class="col-narrow">
          <button type="submit" title="Executar">Executar</button>
        </div>
      </div>

      <!-- BLOCO: PARÂMETROS PREDITIVOS (mostra apenas se modo = preditivo) -->
      <div class="divider"></div>
      <div id="block-preditivo" style="display:none">
        <h3 style="margin:0 0 8px">Parâmetros da Análise Preditiva</h3>
        <p class="subtle">Quando ativado, o fluxo do n8n desvia para a rota de previsão (sem afetar os relatórios padrão).</p>

        <div class="grid-3" style="margin-top:10px">
          <div>
            <label>Métrica-alvo</label>
            <select name="target_metric" disabled>
              <option value="receita" selected>Receita</option>
              <option value="qtd">Quantidade</option>
              <option value="notas">Notas</option>
              <option value="ticket_medio">Ticket médio</option>
            </select>
          </div>

          <div>
            <label>Horizonte (meses)</label>
            <input type="number" name="horizonte" min="1" max="24" value="6" disabled/>
          </div>

          <div>
            <label>Granularidade</label>
            <select name="granularidade" disabled>
              <option value="anual" selected>Anual</option>
              <option value="mensal" selected>Mensal</option>
              <option value="semanal">Semanal</option>
              <option value="diario">Diário</option>
            </select>
          </div>
        </div>

        <div class="grid-3" style="margin-top:10px">
          <div>
            <label>Algoritmo</label>
            <select name="algoritmo" disabled>
              <option value="auto" selected>Auto (sugestão)</option>
              <option value="prophet">Prophet</option>
              <option value="arima">ARIMA</option>
              <option value="xgboost">XGBoost (regressão)</option>
            </select>
          </div>

          <div>
            <label>Confiança (0.80–0.99)</label>
            <input type="number" step="0.01" min="0.80" max="0.99" name="confianca" value="0.90" disabled/>
          </div>

          <div>
            <label>Janela de treino (opcional)</label>
            <input type="text" name="treino_intervalo" placeholder="YYYY-MM-DD a YYYY-MM-DD" disabled/>
          </div>
        </div>

        <div class="grid-2" style="margin-top:10px">
          <div>
            <label>Filtros adicionais (texto livre, opcional)</label>
            <input type="text" name="filtros_texto" placeholder="ex.: somente CFOP 5102 e 6102" disabled/>
          </div>
          <div>
            <label>Cenários/Drivers (opcional)</label>
            <textarea name="cenario" rows="2" placeholder="ex.: +10% marketing Q3; preço +5%" disabled></textarea>
          </div>
        </div>
      </div>
    </form>

    <div class="section">
      <h1>Como usar</h1>
      <p><b>Padrão:</b> faça perguntas sobre as NFs (receita, ticket médio, top fornecedores etc.).</p>
      <p><b>Preditivo:</b> mude o “Modo” para <i>Preditivo</i> e ajuste os parâmetros (métrica, horizonte, algoritmo…).</p>
    </div>
  </div>

  <script>
    (function(){
      const modoSel = document.getElementById('modo');
      const blockPred = document.getElementById('block-preditivo');

      // Habilita/desabilita campos do bloco preditivo e mostra/oculta
      function togglePredictive(){
        const isPred = modoSel.value === 'preditivo';
        blockPred.style.display = isPred ? '' : 'none';
        const inputs = blockPred.querySelectorAll('input, select, textarea');
        inputs.forEach(el => { el.disabled = !isPred; });
      }
      modoSel.addEventListener('change', togglePredictive);
      togglePredictive();

      // Opcional: limpeza automática de campos vazios ao enviar (payload mais limpo)
      document.getElementById('gaia-form').addEventListener('submit', function(ev){
        const form = ev.target;
        // Remove atributos 'name' de inputs vazios (exceto 'modo'/'pergunta'/'uf'/'data_*')
        const keep = new Set(['modo','pergunta','uf','data_inicio','data_fim']);
        Array.from(form.elements).forEach(el=>{
          if (!el.name) return;
          if (keep.has(el.name)) return;
          if (el.disabled) return; // já não vai para o payload
          if (['', null, undefined].includes(el.value?.trim?.())) {
            el.disabled = true; // evita envio de vazios
          }
        });
      });
    })();
  </script>
</body>
</html>
